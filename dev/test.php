<?php
require_once('../app.php');

/*$list = "483588,484246,484253,484522,484572,484589,484662,484708,484742,484766,484805,484814,484853,484856,484894,485063,485086,485092,485109,485287,485506,485507,485513,485515,485520,485772,485773,485834,485866,485884,486117,486130,486186,486192,486207,486282,486303,486404,486410,486425,486430,486450,486466,486532,486546,486608,486709,486856,486910,487400,487439,487517,487520,487557,487616,487617,487696,487727,487749,487812,487822,487895,487896,487901,487904,487960,487981,488091,488160,488180,488401,488506,488543,488571,488635,488647,488847,488905,488978,489148,489208,489209,489216,489300,489344,489348,489352,489464,489495,489600,489720,489726,489729,489732,489839,489880,489924,489976,490006,490016,490095,490473,490516,490576,490581,490584,490587,490588,490594,490614,490698,490733,490932,490982,491117,491161,491231,491315,491377,491386,491414,491470,491572,491781,491973,492079,492141,492356,492395,492405,492407,492516,492541,492552,492553,492731,492809,492892,493079,493436,493442,493556,493652,493751,493888,493959,493973,494360,494443,494531,494553,494557,494590,494610,494612,494664,494985,495419,495463,495497,495516,495573,495678,495707,495713,495730,495738,495749,495851,495854,496017,496087,496096,496204,496407,496421,496429,496479,496490,496493,496633,496657,496768,497005,497030,497146,497361,497386,497391,497394,497453,497480,497484,497511,497516,497631,497798,497845,498027,498054,498119,498174,498178,498219,498552,498553,498636,498643,498907,498918,498919,498976,499200,499213,499249,499329,499334,499351,499390,499434,499506,499575,499641,499679,499686,499692,499733,499734,499765,499779,499829,499833,499834,499852,499898,499969,500055,500060,500334,500391,500432,500434,500448,500500,500674,500876,500883,500888,501011,501041,501048,501078,501116,501280,501291,501331,501561,501635,501661,501755,501843,501847,501866,501913,501983,502131,502197,502453,502667,502676,502969,503143,503145,503189,503251,503264,503375,503910,503968,504153,504160,504402,504418,504546,505902,506850,507420,507426,507441,508327,508371,508417,508426,508468,508740,508970,509237,509355,509486,509810,509825,510011,510038,510050,510294,510334,510342,510401,510414,510421,510427,510441,510447,510466,510726,510731,510733,511118,511504,511670,511829,512116,512579,512650,512699,512771,513740,513845,514095,514173,514392,514441,514456,514722,514921,515103,515462,515998,516277,516303,516465,516567,516685,516692,516725,516733,516736,516765,516776,516793,516797,516831,516845,516848,516991,517480,517778,517785,517934,517964,518027,518265,519127,519146,519478,519491,519932,519997,520134,520143,520174,520365,520419,520545,520588,520639,520726,520729,520736,520745,520753,520803,520850,520935,520968,521042,521211,521226,521618,521651,521662,521850,521893,521969,522513,522598,522875,523008,523035,523046,523236,523245,523257,523445,523482,523578,523889,524187,524346,524425,524474,524803,525005,525016,525033,525089,525438,525440,525559,525598,525690,525814,525835,525944,525945,525971,526129,526226,526341,526607,526846,526906,527435,527626,527636,527649,527817,527887,527897,527968,528014,528290,528355,528436,528448,528518,528596,528764,528865,528894,528896,528937,528943,528968,528971,529043,529167,529274,529306,529311,529333,529341,529385,529561,529573,530492,530515,530618,530651,530727,530897,530931,530977,530986,531470,531472,531474,531720,531861,532025,532076,532181,532230,532546,532606,532611,532612,532689,532883,532983,533028,533881,534067,534070,534164,534220,534422,534459,534857,534867,535804,536135,537087,537348,537395,537803,537965,538311,538366,538559,538692,538714,539101,539122,539157,539176,539233,539585,539927,539959,539986,540038,540179,540590,540609,540867,541563,541569,541584,541920,541984,542040,542402,542603,542772,542957,543053,543089,543157,543573,543972";
$html = "<table border=1><tr bgcolor='#cccccc'><td colspan='4'>KH co DH va Ma GD Ngan Luong</td></tr><tr><td>Ho Ten</td><td>Dien thoai</td><td>Ma DH</td><td>Ma GD Ngan Luong</td></tr>";
$html1 = "<table border=1><tr bgcolor='#cccccc'><td colspan='4'>KH co DH nhung chua co Ma GD Ngan Luong</td></tr><tr><td>Ho Ten</td><td>Dien thoai</td><td>Ma DH</td><td>Ma GD Ngan Luong</td></tr>";

$o = DB::GetQueryResult("SELECT transaction_id_nl, id, realname, mobile FROM `order` WHERE transaction_id_nl IN (".$list.")",false);
foreach($o as $k => $v){
	
	if((int)$v['transaction_id_nl']>0){
		$html .="<tr><td>".$v['realname']."</td><td>".$v['mobile']."</td><td>".$v['id']."</td><td>".$v['transaction_id_nl']."</td></tr>";	
	}else{
		$html1 .="<tr><td>".$v['realname']."</td><td>".$v['mobile']."</td><td>".$v['id']."</td><td>".$v['transaction_id_nl']."</td></tr>";	
	}
}
echo $html .="</table>"; $html1 .="</table>";*/

/*echo base64_encode('58013-78071')."<br>";
echo base64_decode('NTgwMTMtNzgwNzE=');*/


/*$s = DB::GetQueryResult("SELECT mobile, user_id, quantity_successful, price FROM `order` WHERE team_id=717 AND state='pay'", false);

foreach($s as $index => $one){
	$a = DB::GetQueryResult("SELECT id FROM `user` WHERE mobile='".$one['mobile']."'");
	if((int)$a['id']>0){
		$d = DB::GetQueryResult("SELECT id FROM credit_gift WHERE user_id='".$a['id']."' AND deal_id=717");
		if((int)$d['id']==0){
			$money = $one['price']*$one['quantity_successful'];
			echo $query = "INSERT INTO credit_gift(deal_id, user_id, money, notes, created) VALUES('717','".$a['id']."','".$money."','Do san pham Mascara L.A CORLORS bi loi','2012-05-24 3:41:41');<br>";
			echo $query1 = "UPDATE `user` SET money=(money+".$money.") WHERE id=".$a['id'].";<br>";
		}else{
			echo "<strong style='color:#0000ff'>ID Gift: ".(int)$d['id']." - User: ".$a['id']." - DT: ". $one['mobile']." da cong tien roi</strong><br>";
		}
	}else{
		echo "<strong style='color:#ff0000'>So dt: ".$one['mobile']." khong ton tai</strong><br>";	
	}
}*/
//Check 
/*$list_oid = "227424,227427,227431,227433,227434,227438,227440,227444,227451,227454,227455,227456,227460,227461,227462,227464,227467,227471,227472,227473,227478,227480,227483,227484,227487,227488,227489,227490,227492,227493,227495,227497,227498,227499,227500,227501,227503,227504,227508,227511,227513,227516,227517,227519,227527,227530,227533,227535,227539,227541,227545,227546,227547,227549,227554,227558,227561,227562,227563,227566,227567,227568,227569,227574,227575,227576,227577,227581,227585,227591,227594,227596,227597,227599,227602,227603,227604,227608,227609,227611,227612,227615,227616,227617,227620,227622,227624,227625,227627,227633,227638,227642,227645,227648,227649,227650,227653,227656,227658,227660,227661,227662,227663,227664,227665,227666,227669,227670,227673,227675,227676,227677,227678,227679,227680,227681,227682,227683,227684,227685,227686,227688,227690,227691,227693,227694,227696,227698,227700,227701,227703,227709,227710,227711,227714,227716,227717,227718,227719,227720,227723,242599,242852,243113,243751,243782,243849,244030,244105,244203,245117,245271,245353,245425,245445,245645,245667,245701,245793,245804,245986,246298,246342,246573,246650,246815,246818,247551,247662,247669,247677,247738,247855,247901,248226,248227,248460,248642,248669,248680,248849,248989,249405,249458,249695,249701,249809,249934,250296,250567,250644,250673,250980,250982,251284,251731,251796,251991,252215,252310,252583,252642,252692,252828,253311,253478,253721,254408,254879,255507,255566,255729,256165,256345,256463,256687,256713,257040,257568,257869,258024,258041,258095,258157,258195,258218,258824,258982,259419,259636,259653,259740,259922,259929,260007,260079,260417,260450,260630,260765,260776,260896,260922,261004,261217,261413,261443,261639,261646,261818,261896,262417,262482,262505,262608,262709,262718,262731,262746,263052,263161,263165,263168,263487,263489,263665,263698,263728,263760,263774,264157,264748,264899,264901,264911,265107,265491,265580,265741,266725,266728,266877,267249,267283,267769,267800,267819,267877,268110,268111,268201,268225";
$order = array();
$oo = DB::GetQueryResult("SELECT user_id, id, mobile, team_id FROM `order` WHERE id IN (".$list_oid.")",false);
foreach($oo as $k => $vv){
	$str_arr = array("0","1","2","3","4","5","6","7","8","9","0","1","2","3","4","5","6","7","8","9");
	$keys = array_rand($str_arr, 5);
	$str='';
	foreach($keys as $n=>$i){
		$str.= $str_arr[$i];
	}
	DB::Insert('verify_code',array(
		'cus_id' => $vv['user_id'],
		'cus_mobile' => $vv['mobile'],
		'team_id' => 753,
		'verify_code' => $str.$vv['user_id'],
		'status' => 'sended',
	));
	$aa = DB::GetQueryResult("SELECT email FROM `user` WHERE id='".$vv['user_id']."'");
	$email = strtolower($enc->decrypt('@4!@#$%@', $aa['email']));
	$str_url = "http://www.dealsoc.vn/team/activecode.php?id=".$vv['id']."&mobile=".$vv['mobile']."&did=".$vv['team_id']."&code=".$str.$vv['user_id'];
	$subject = "Dealsoc.vn - Xác nhận tham gia chương trình \"Miễn phí 01 năm mua sắm trên web: www.dealsoc.vn\"";
	$content = render('order_email_active_code', $order);
	mail_custom($email, $subject, $content);
}*/


//Kiem tra khach hang co don hang nhung chua co ma so du thuong
/*$html = "<table border=1><tr bgcolor='#cccccc'><td colspan='8'>KH co DH va Nhung chua co ma so du thuong</td></tr><tr><td>Ho Ten</td><td>Dien thoai</td><td>Ma DH</td><td width='30%'>Dia chi</td><td>Ma xac nhan</td><td>Xac nhan</td><td>Ma so du thuong</td></tr>";
$s = DB::GetQueryResult("SELECT mobile, user_id, realname, id, bnote_address, baddress, bdist_id, bward_id, bcity_id FROM `order` WHERE team_id=753", false);
foreach($s as $index => $one){
	if($one['bnote_address']!=''){
			$note_address = htmlspecialchars($one['bnote_address']).", ";
	}
	$address = $note_address.htmlspecialchars($one['baddress']);
	if(ward_name($one['bdist_id'],$one['bward_id'])){
		$wardname = ward_name($one['bdist_id'],$one['bward_id']);
		$address .=", ".strip_input($wardname['ward_name']);
	}
	if(ename_dist($one['bdist_id'])){
		$dists = ename_dist($one['bdist_id']);
		$address .=", ".strip_input($dists['dist_name']);		
	}
	if(id_city($one['bcity_id'])){
		$citys = id_city($one['bcity_id']);
		$address .=", ".strip_input($citys['name']);		
    }
	$a = DB::GetQueryResult("SELECT maso FROM `masoduthuong` WHERE team_id='753' AND user_id='".$one['user_id']."'");
	if($a['maso']==0){
		$b = DB::GetQueryResult("SELECT verified, verify_code FROM `verify_code` WHERE cus_id='".$one['user_id']."' AND cus_mobile='".$one['mobile']."' AND team_id='753'");
		$query = "INSERT INTO masoduthuong(order_id, team_id, user_id, fullname, address, telephone) VALUES('".$one['id']."','753','".$one['user_id']."','".$one['realname']."','".$address."','".$one['mobile']."')";
		$html .="<tr><td>".$one['realname']."</td><td>".$one['mobile']."</td><td>".$one['id']."</td><td>".$address."</td><td>".$b['verify_code']."</td><td>".$b['verified']."</td><td>".$a['maso']."</td></tr>";if($b['verified']=='Y'){$html .="<tr><td colspan=8>".$query."</td></tr>";}	
	}
}
echo $html .="</table>";*/

/*

$s = DB::GetQueryResult("SELECT
`order`.realname,
`order`.mobile,
`user`.email,
(`order`.price*`order`.quantity_successful) as thanh_tien, CONCAT(`order`.address,', ',countries_ward.ward_name,', ',countries_district.dist_name,', ',countries_state.`name`) as dia_chi, `order`.id as ma_dh, transaction_id_nl
FROM
`order`
INNER JOIN countries_ward ON `order`.ward_id = countries_ward.id
INNER JOIN countries_district ON `order`.dist_id = countries_district.dist_id
INNER JOIN countries_state ON `order`.city_id = countries_state.id
INNER JOIN `user` ON `order`.user_id = `user`.id
WHERE transaction_id_nl IN (483588,484246,484253,484522,484572,484589,484662,484708,484742,484766,484805,484814,484853,484856,484894,485063,485086,485092,485109,485287,485506,485507,485513,485515,485520,485772,485773,485834,485866,485884,486117,486130,486186,486192,486207,486282,486303,486404,486410,486425,486430,486450,486466,486532,486546,486608,486709,486856,486910,487400,487439,487517,487520,487557,487616,487617,487696,487727,487749,487812,487822,487895,487896,487901,487904,487960,487981,488091,488160,488180,488401,488506,488543,488571,488635,488647,488847,488905,488978,489148,489208,489209,489216,489300,489344,489348,489352,489464,489495,489600,489720,489726,489729,489732,489839,489880,489924,489976,490006,490016,490095,490473,490516,490576,490581,490584,490587,490588,490594,490614,490698,490733,490932,490982,491117,491161,491231,491315,491377,491386,491414,491470,491572,491781,491973,492079,492141,492356,492395,492405,492407,492516,492541,492552,492553,492731,492809,492892,493079,493436,493442,493556,493652,493751,493888,493959,493973,494360,494443,494531,494553,494557,494590,494610,494612,494664,494985,495419,495463,495497,495516,495573,495678,495707,495713,495730,495738,495749,495851,495854,496017,496087,496096,496204,496407,496421,496429,496479,496490,496493,496633,496657,496768,497005,497030,497146,497361,497386,497391,497394,497453,497480,497484,497511,497516,497631,497798,497845,498027,498054,498119,498174,498178,498219,498552,498553,498636,498643,498907,498918,498919,498976,499200,499213,499249,499329,499334,499351,499390,499434,499506,499575,499641,499679,499686,499692,499733,499734,499765,499779,499829,499833,499834,499852,499898,499969,500055,500060,500334,500391,500432,500434,500448,500500,500674,500876,500883,500888,501011,501041,501048,501078,501116,501280,501291,501331,501561,501635,501661,501843,501847,501866,501913,501983,502131,502197,502453,502667,502676,502969,503143,503145,503189,503251,503264,503375,503910,503968,504153,504160,504402,504418,504546,505902,506850,507420,507426,507441,508327,508371,508417,508426,508468,508740,508970,509237,509355,509486,509810,509825,510011,510038,510050,510294,510334,510342,510401,510414,510421,510427,510441,510447,510466,510726,510731,510733,511118,511504,511670,511829,512116,512579,512650,512699,512771,513740,513845,514095,514173,514392,514441,514456,514722,514921,515103,515462,515998,516277,516303,516465,516567,516685,516692,516725,516733,516736,516765,516776,516793,516797,516831,516845,516848,516991,517480,517778,517785,517934,517964,518027,518265,519127,519146,519478,519491,519932,519997,520134,520143,520174,520365,520419,520545,520588,520639,520726,520729,520736,520745,520753,520803,520850,520935,520968,521042,521211,521226,521618,521651,521662,521850,521893,521969,522513,522598,522875,523008,523035,523046,523236,523245,523257,523445,523482,523578,523889,524187,524346,524425,524474,524803,525005,525016,525033,525089,525438,525440,525559,525598,525690,525814,525835,525944,525945,525971,526129,526226,526341,526607,526846,526906,527435,527626,527636,527649,527817,527887,527897,527968,528014,528290,528355,528436,528448,528518,528596,528764,528865,528894,528896,528937,528943,528968,528971,529043,529167,529274,529306,529311,529333,529341,529385,529561,529573,530492,530515,530618,530651,530727,530897,530931,530977,530986,531470,531472,531474,531720,531861,532025,532076,532181,532230,532546,532606,532611,532612,532689,532883,532983,533028,533881,534067,534070,534164,534220,534422,534459,534857,534867,535804,536135,537087,537348,537395,537803,537965,538311,538366,538559,538692,538714,539101,539122,539157,539176,539233,539585,539927,539959,539986,540038,540179,540590,540609,540867,541563,541569,541584,541920,541984,542040,542402,542603,542772,542957,543053,543089,543157,543573,543972)", false);

$html = "<table border=1><tr bgcolor='#cccccc'><td colspan='7'>Danh sach khach hang mua voucher Dealsoc duoc giam them 5% khi thanh toan qua NganLuong</td></tr><tr><td>Ho Ten</td><td>Dien thoai</td><td>Email</td><td>So Tien</td><td>Dia Chi</td><td>Ma DH</td><td>Ma DG NganLuong</td></tr>";
foreach($s as $k => $v){
	$html .="<tr><td>".$v['realname']."</td><td>".$v['mobile']."</td><td>".$enc->decrypt('@4!@#$%@', $v['email'])."</td><td>".$v['thanh_tien']."</td><td>".$v['dia_chi']."</td><td>".$v['ma_dh']."</td><td>".$v['transaction_id_nl']."</td></tr>";	
}
echo $html .="</table>";*/
?>